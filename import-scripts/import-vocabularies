#!/usr/bin/env python
"""
Import some basic EarthChem vocabularies from
http://www.earthchem.org/resources/vocabularies
for data categorization.
"""

import pandas as P
from sqlalchemy import create_engine

def get_table(category):
    url = f'http://www.earthchem.org/petdbWeb/search/vocabulary.jsp?category={category}'
    tables = P.read_html(url, index_col=0) # Returns list of all tables on page
    df = tables[0]
    df["authority"] = "EarthChem"
    df.index.names = ['id']
    df.rename(columns={
        'METHOD_NAME': 'description',
        'DESCRIPTION': 'description'}, inplace=True)
    return df

conn = create_engine("postgresql:///earthcube_labdata")

def write_table(tbl, name):
    return tbl.to_sql(name, conn, schema='vocabulary', if_exists='append')

def copy_table(category, tbl):
    df = get_table(category)
    write_table(df, tbl)
    return df

units = copy_table("Unit", "unit")
methods = copy_table("Method", "method")
parameters = copy_table("MeasuredParameter", "parameter")


